第3章交换机与虚拟局域网 交换机的工作原理 交换式局域网 虚拟局域网的原理 配置虚拟局域网以太网已经变得越来越拥塞，主要是由于网络应用和网络用户的需求迅速增长。现在，处于同一个以太网上的两个站点很容易就会使网络不堪重负。为了提高局域网的效率，交换技术就产生了。本章主要围绕交换技术来介绍交换机、交换式局域网以及虚拟局域网的知识。3.1交换机〖*1〗3.1.1核心知识1. 交换机简介交换机是局域网中使用非常广泛的网络设备，它工作在数据链路层，属于数据链路层的交换设备。交换机的分类方法比较多，根据交换机所应用的局域网类型不同，可将交换机分为10Mbps以太网交换机、100Mbps快速交换机、千兆交换机等。交换机如图3.1所示。2. 交换机的工作原理典型的交换机就是以太网交换机。交换机是可以通过端口与端口之间的多个并发连接，实现多节点之间数据的并发传输。这种数据传输方式与集线器那种共享带宽的方式完全不同。在2.3.3小节中，讲过MAC地址这部分知识。事实上，在交换机里存在一个“端口MAC地址映射表”，在这个表中，每个MAC地址都对应于交换机的一个唯一的端口。对应于图3.2，交换机中的“端口MAC地址映射表”如表3.1所示。表3.1MAC地址映射表MAC地址端口号计时0113AF456E7D（节点A）1…0113AFAC1D83（节点B)2…123E428D9128（节点C）2…123E424C7A79（节点D）3…3456892A4E7F（节点E）4…………如图3.2所示，计算机B、计算机C是通过集线器连接到交换机，而计算机A、计算机D和计算机E是直接连在交换机上。根据表3.1和图3.2，可以将计算机和端口的图描绘出来，如图3.3所示。图3.1交换机图3.2交换机连接的网络 
第3章交换机与虚拟局域网  交换机的工作原理  交换式局域网  虚拟局域网的原理  配置虚拟局域网以太网已经变得越来越拥塞，主要是由于网络应用和网络用户的需求迅速增长。现在，处于同一个以太网上的两个站点很容易就会使网络不堪重负。为了提高局域网的效率，交换技术就产生了。本章主要围绕交换技术来介绍交换机、交换式局域网以及虚拟局域网的知识。3.1交换机〖*1〗3.1.1核心知识1.  交换机简介交换机是局域网中使用非常广泛的网络设备，它工作在数据链路层，属于数据链路层的交换设备。交换机的分类方法比较多，根据交换机所应用的局域网类型不同，可将交换机分为10Mbps以太网交换机、100Mbps快速交换机、千兆交换机等。交换机如图3.1所示。2.  交换机的工作原理典型的交换机就是以太网交换机。交换机是可以通过端口与端口之间的多个并发连接，实现多节点之间数据的并发传输。这种数据传输方式与集线器那种共享带宽的方式完全不同。在2.3.3小节中，讲过MAC地址这部分知识。事实上，在交换机里存在一个“端口MAC地址映射表”，在这个表中，每个MAC地址都对应于交换机的一个唯一的端口。对应于图3.2，交换机中的“端口MAC地址映射表”如表3.1所示。表3.1MAC地址映射表MAC地址端口号计时0113AF456E7D（节点A）1…0113AFAC1D83（节点B)2…123E428D9128（节点C）2…123E424C7A79（节点D）3…3456892A4E7F（节点E）4…………如图3.2所示，计算机B、计算机C是通过集线器连接到交换机，而计算机A、计算机D和计算机E是直接连在交换机上。根据表3.1和图3.2，可以将计算机和端口的图描绘出来，如图3.3所示。图3.1交换机图3.2交换机连接的网络

图3.3交换机端口和计算机对应图如果计算机D要发送信息给计算机E，计算机D首先将目的MAC地址指向计算机E的帧发往交换机。交换机接收该帧，并且检测到了目的MAC地址后，在交换机的“端口/MAC地址表”中查找计算机E的端口号，即4号端口。这样，源主机D(3号端口)和目的主机E(4号端口)都已经确定，数据包的传送路径也只需从3号端口通过交换机直接转发给4号端口。那么，如果同时计算机A要给计算机B发送信息，则交换机的1号端口与2号端口也将建立一条连接，并将1号端口接收到的信息转发到2号端口。这样，交换机在1号端口至2号端口和3号端口至4号端口之间就建立了两条并发的连接。计算机A和计算机D可以同时发送信息，计算机B和计算机C因为接在集线器连接的共享式以太网中，所以同时会收到计算机A(1号端口)的数据包。同样地，根据共享式以太网的原理，通过对目的MAC地址的识别，计算机C会抛弃数据包，计算机B留下数据包，数据传送完毕。由此可以看出，交换机是利用这些并发连接，对要求交换机接收到的数据信息进行转发和交换。3.  交换机的功能1) 地址学习以太网交换机利用“端口/MAC地址映射表”进行信息的交换，因此，“端口/MAC地址映射表”的建立和维护就变得非常重要。因为，一旦“端口/MAC地址映射表”出现错误，就可能造成信息转发错误。那么“端口/MAC地址映射表”是如何建立和维护的呢？这里需要解决的问题一共有两个，一是交换机如何知道哪台计算机连接到哪个端口；二是当计算机在交换机的端口之间移动时，交换机如何维护地址映射表。如果通过人工建立交换机的“端口/MAC地址映射表”是非常不现实的，因为端口连接计算机的情况是经常改变的。因此，交换机应该自动建立“端口/MAC地址映射表”。换句话来说，交换机应该动态建立和维护“端口/MAC地址映射表”，将这种维护“端口/MAC地址映射表”的方式称为“地址学习”。“地址学习”是通过读取两个内容，一个是数据包的源地址；另一个是数据包进入交换机的端口，并将源地址和端口一一记录到交换机的“端口/MAC地址映射表”，这样就建立了端口与MAC地址的对应关系。当得到对应关系后，交换机将检查地址映射表中是否已经存在该对应关系。如果不存在，就添加到“端口/MAC地址映射表”；如果存在，就将“端口/MAC地址映射表”该表项更新。例如，在图3.2中，假设“端口/MAC地址映射表”中没有计算机E的MAC地址与交换机的端口对应关系，那么，计算机A要向计算机E发送数据包，而交换机在接收到1号端口的数据包之后，发现目的MAC地址(计算机E)在“端口/MAC地址映射表”中查询不到。为了保证数据包能够到达正确的目的地，交换机会向除了源端口(1号端口)之外的所有端口发送这个数据包。当然，大家都知道，网络传输永远是双向的，当计算机E给计算机A发送回应数据包时，交换机就会捕捉到计算机E的MAC地址与端口的对应关系，就将这个对应关系存储到“端口/MAC地址映射表”。假设计算机E的端口发生改变，由4号端口换到了5号端口，则计算机D要给计算机E发送信息时，通过“端口/MAC地址映射表”，将数据包发送到了5号端口，而却收不到4号端口的回应数据包，则证明此次数据传输失败。因此，计算机D重新发送数据包给交换机的所有端口，而计算机D在收到这个数据包并通过交换机5号端口回应数据包时，交换机将计算机D的MAC地址与5号端口的对应关系更新到交换机的“端口/MAC地址映射表”。在每次添加或更新地址映射表时，这个过程会增加一个计时器。所以，每个“端口/MAC地址映射表”的映射表项在计时器的范围内，会存储在交换机中。如果在计时器溢出之前都没有再次学习到这个“端口/MAC地址映射表”表项，则视为这个映射表项已经过期，交换机将其删除。这样，交换机就能维护一个实时更新的“端口/MAC地址映射表”。2) 通信过滤交换机的“端口/MAC地址映射表”建立之后，它就可以对通过的信息进行过滤了。这个“通信过滤”的过程，可以做以下详细描述。如图3.4所示，计算机A和计算机B以及计算机D和计算机E都是通过集线器连接，计算机C和计算机F是直接连接交换机。图3.4网络拓扑图从前面讲到的交换机原理可以知道，如果计算机A要给计算机C发送数据包，通过“端口/MAC地址映射表”，信息只从交换机的1号端口传送到2号端口，而不再向3号、4号端口转发。如果计算机A要给计算机B发送数据包，交换机在1号端口收到数据包，而交换机发现目的端口与源端口一致，就不再转发数据包，直接把数据包抛弃，数据包就在集线器连接的局域网中传送。类似这样的过程就被称为交换机的“通信过滤”。交换机的“通信过滤”能够避免网络上不必要的数据传输，减少了网络的通信负荷，为网络提供了更多的带宽，提高了网络的利用率。4.  交换机的访问方式交换机的访问一般都支持4种方式： 连接控制台方式、连接设备AUX端口方式、远程登录方式和Web配置方式。1) 连接控制台方式Console端口是交换机提供的专用管理端口，可以通过相关的连接电缆，一端插入交换机的Console端口，另一端接入计算机的串口，以建立计算机与交换机的配置连接。通过Console端口连接并配置交换机是管理交换机必须经过的步骤，因为其他的管理和配置方式都需要先通过Console端口对交换机实施基本配置后才能进行。不同品牌交换机的Console端口有不同的类型，但绝大多数都采用RJ45端口，也有少数是串行端口。因此，要通过Console端口配置交换机就需要专门的Console连接线，Console连接线主要有两种： 一种是串行线，采用DB9或DB25的串行插口线；另一种是采用RJ45接头的翻转线。图3.5展示了一台计算机终端通过控制台端口与交换机连接的实例，具体连接步骤会在3.1.4小节实践环节中具体阐述。图3.5连接控制台方式2) 连接设备AUX端口方式连接设备AUX端口方式一般适用于远程移动用户的登录配置，有时网络管理员经常需要对远程的交换机进行操作，那么，采用这种方式，如果管理员需要对网络设备进行远程配置操作，就可以通过Modem连接设备的AUX端口，通过电话拨号的方式远程配置设备。3) 远程登录方式远程登录方式(Telnet)是网络管理员经常使用的配置方式之一。在实际网络环境中，网络的规模可能相当庞大，其地域覆盖甚至超过几十千米甚至上千千米。这种情况下，一个网络管理员是无法随时在设备面前对该设备实施配置操作的。通过Telnet方式，管理员就可以通过网络登录到远程设备上，像在设备面前一样轻松地完成配置。4) Web配置方式大多数的网络设备都支持Web配置方式，像访问WWW一样，只需打开IE浏览器，直接输入交换机的管理地址(IP地址)，就能进入交换机的管理界面，如一些基于Web的管理软件Cisco Work或HP Open View等。Web配置方式是基于HTTP的，这样网络管理员就能够从远程通过浏览器以图形化的界面方式来配置，因此具有操作直观、简便的优点。但是，由于Web配置在安全性方面比前几种方式要差且管理功能有限，所以在大型网络管理中并不常见。3.1.2能力目标  掌握计算机与交换机的连接。  Console端口的配置。  掌握查看“端口/MAC地址映射表”的方法。 显示全部信息